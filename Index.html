  const checked = [...document.querySelectorAll('#checklist input:checked')]
                  .map(cb => parseInt(cb.value,10));   // 例: [2,5,9]

  // 2️⃣ 產生完整的 1~18 數字陣列
  const allNumbers = Array.from({length: TOTAL_NUM}, (_,i) => i+1);

  // 3️⃣ 把標記與非標記分開
  const marked   = allNumbers.filter(n => checked.includes(n));
  const unmarked = allNumbers.filter(n => !checked.includes(n));

  // 4️⃣ 先把標記平均分配到三組
  const groups = Array.from({length: GROUP_COUNT}, () => []);
  const targetMarkedPerGroup = Math.floor(marked.length / GROUP_COUNT);
  const extraMarked = marked.length % GROUP_COUNT; // 會給前 extraMarked 組

  // 隨機打亂標記的順序，避免總是同樣順序
  shuffle(marked);

  // 為每組放入目標的標記個數
  let idx = 0;
  for (let g = 0; g < GROUP_COUNT; g++) {
    const need = targetMarkedPerGroup + (g < extraMarked ? 1 : 0);
    for (let i = 0; i < need; i++) {
      groups[g].push(marked[idx++]);
    }
  }

  // 5️⃣ 接著把普通數字隨機分配，填滿每組到 6 個
  shuffle(unmarked);
  let uIdx = 0;
  for (let g = 0; g < GROUP_COUNT; g++) {
    while (groups[g].length < PER_GROUP) {
      groups[g].push(unmarked[uIdx++]);
    }
  }

  // 6️⃣ 顯示結果
  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = ''; // 清空舊結果
  groups.forEach((grp, i) => {
    const box = document.createElement('div');
    box.className = 'group';
    box.innerHTML = `<h2>第 ${i+1} 組</h2><ul>` +
                    grp.map(n => `<li>${n}${checked.includes(n) ? ' <strong>(標記)</strong>' : ''}</li>`).join('') +
                    `</ul>`;
    resultDiv.appendChild(box);
  });
}
</script>
</body>
</html>
    
